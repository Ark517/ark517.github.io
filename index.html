<!DOCTYPE html>
<html>

<head>
    <title>直连地址</title>
    <meta charset="UTF-8">
</head>

<body>
    <script>
        const x = ['z', 'y', 'x', '.', '0', '0', '0', '7', '1', '5'].reverse().join("");
        Date.prototype.Format = function (fmt) {
            var o = {
                "M+": this.getMonth() + 1, //月份
                "d+": this.getDate(), //日
                "H+": this.getHours(), //小时
                "m+": this.getMinutes(), //分
                "s+": this.getSeconds(), //秒
                "q+": Math.floor((this.getMonth() + 3) / 3), //季度
                "S": this.getMilliseconds() //毫秒
            };
            if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
            for (var k in o)
                if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
            return fmt;
        }
        var randDelay = function () {
            let delay = 999;
            while (delay > 50 || delay < 10) {
                delay = Math.round(Math.random() * 100)
            };
            return delay;
        }
        // 创建 DOM
        var createDom = function () {
            String.prototype.hashCode = function () {
                var hash = 0, i, chr;
                if (this.length === 0) return hash;
                for (i = 0; i < this.length; i++) {
                    chr = this.charCodeAt(i);
                    hash = ((hash << 5) - hash) + chr;
                    hash |= 0; // Convert to 32bit integer
                }
                return hash;
            };
            // 创建标题
            var h1 = document.createElement("h1");
            h1.innerHTML = "方舟服务器直连地址";
            document.body.appendChild(h1);
            // 创建表格
            var table = document.createElement("table");
            table.id = "serverTable";
            table.style.minWidth = "1500px";
            document.body.appendChild(table);
            // 创建表头
            var thead = document.createElement("thead");
            table.appendChild(thead);
            var tr = document.createElement("tr");
            thead.appendChild(tr);
            var thTitles = ["服务器名称", "永久直连地址", "游戏类型", "服务器版本", "服务器状态", "在线玩家", "最后更新时间", "延迟"];
            for (var i = 0; i < thTitles.length; i++) {
                var th = document.createElement("th");
                th.innerHTML = thTitles[i];
                tr.appendChild(th);
            }
            // 创建表格内容
            var tbody = document.createElement("tbody");
            table.appendChild(tbody);
        }
        createDom();

        // 更新样式
        var updateStyle = function () {
            // 修改标题样式
            const h1 = document.querySelector('h1');
            h1.style.textAlign = "center";
            h1.style.fontSize = "3rem";
            // 修改表格样式
            const table = document.querySelector('table');
            table.style.borderCollapse = "collapse";
            table.style.margin = "0 auto";
            table.style.border = "1px solid #ccc";
            // 修改表头样式
            const thList = table.getElementsByTagName("th");
            for (var i = 0; i < thList.length; i++) {
                thList[i].style.backgroundColor = "#4CAF50";
                thList[i].style.color = "#fff";
                thList[i].style.fontWeight = "bold";
                thList[i].style.padding = "5px";
                thList[i].style.textAlign = "center";
                thList[i].style.border = "1px solid #ccc";
                thList[i].style.padding = "5px 20px";
                thList[i].style.fontSize = "1.3rem";
            }
            // 修改内容行样式
            const tdList = table.getElementsByTagName("td");
            for (var i = 0; i < tdList.length; i++) {
                tdList[i].style.padding = "5px";
                tdList[i].style.textAlign = "center";
                tdList[i].style.border = "1px solid #ccc";
                tdList[i].style.padding = "5px 20px";
                tdList[i].style.ho
            }
        }
        updateStyle();

        // 更新数据
        var updateData = function () {
            var serversData = [];
            // 模拟数据
            const timeNow = new Date().Format("yyyy-MM-dd HH:mm:ss") // 接口没写 暂时填充
            let serverNames = ['创一', '创二', '孤岛', '畸变', '迷失岛', '水晶岛', '瓦古', '中心岛', '灭绝', '仙境', '焦土', '维京'];
            let basePort = 22000;
            for (let i = 0; i < serverNames.length; i++) {
                serversData.push({
                    serverName: serverNames[i],
                    steamAddress: "0.0.0.0:" + basePort,
                    gameType: "PVE",
                    serverVersion: "-.-",
                    serverStatus: "Online",
                    playerCount: "?",
                    lastUpdateTime: timeNow,
                    latency: randDelay() + "ms",
                })
                basePort += 2;
            }
            // 创建行数据
            const serverNameTmpl = "517老文方舟 - {serverName} - 萌新服";
            const steamAddressTmpl = "steam://connect/{steamAddress}";
            const tbody = document.querySelector('tbody');
            tbody.innerHTML = '';
            for (let i = 0; i < serversData.length; i++) {
                const server = serversData[i];
                console.log(server);
                const serverHash = server.steamAddress.hashCode();
                var tr = document.createElement("tr");
                tr.id = serverHash;
                tbody.appendChild(tr);
                for (const key in server) {
                    var td = document.createElement("td");
                    switch (key) {
                        case 'serverName':
                            server[key] = serverNameTmpl.replace("{serverName}", server[key]);
                            break;
                        case 'steamAddress':
                            server[key] = server[key].replace("0.0.0.0", x);
                            server[key] = steamAddressTmpl.replace("{steamAddress}", server[key]);
                            server[key] = "<a href='" + server[key] + "'>" + server[key] + "</a>";
                            break;
                        case 'serverStatus':
                            server[key] = server[key] == "Online" ? "在线" : "离线";
                            break;
                        default:
                            break;
                    }
                    td.innerHTML = server[key];
                    tr.appendChild(td);
                }
            }
            updateStyle();
        }
        updateData();
        setInterval(updateData, 5000);
    </script>
</body>

</html>